Introduction
============
This folder containts the supplementary materials for the article Fatela, J., Heimes, A., Vorländer, M., Massimiliano, M. and Maffei, L. (2025). “Acoustic radiosity simulation with custom bidirectional reflectance distribution implementation in 3-D.", Journal of the Acoustical Society of America, **?**, 2025, **?**, pp. **?**.

The authors recommend an attentive reading of this paper before exploring these materials: many of the concepts used here are only explained in the article. This documentation also refers extensively to specific sections in the paper.

The original datasets used for the paper are accessible in folder ``resources/paper/``, and the original Figures can be found in ``figures/``.

However, in a commitment to the validation of the paper results, the authors recommend exploring and running the different Jupyter notebooks (``.ipynb``) contained in the head directory. For this, a special installation is necessary (see next section). Some acquaintance with the Python programming language is needed for thorough understanding of these materials. 

Installation
============
**NOTE:** the notebook examples will not perform correctly, unless the installation is perfectly followed. Since sparrowpy's development is continuous, the exact install version (1.0.0) must be respected. The performance of the python scripts may also be affected unless the same dependencies are installed.

### Requirements
In order to run the examples, you must have Python=3.11 installed on your machine. The authors only guarantee functionality for this version.

### Environment
We recommend the user create a local virtual environment and install the dependencies. This allows all examples to be run locally in the user's machine.

**[Installation using virtualenv and pip]**

1. Open a terminal window in the current directory.
2. Input the following line to create your virtual environment in a local directory ``.venv/``:
```
python -m venv .venv
```
or, to create your environment with a specific version of python
```
path/to/the/desired/python/install/python.exe -m venv .venv
```
3. Then, the dependencies for the virtual environment should be installed. We recommend using the following to install the requirements used for the paper:
```
pip install -r requirements.txt
```
4. Done!

In case issues arise

Examples
===============
These materials contain a set of jupyter notebooks which document the step-by-step simulations used to achieve the results of the application examples described in the paper. The prefixes of the notebook examples map to the relevant paper sections. 

We recommend running these examples step by step, and getting acquainted with the simulation. **Only in the original conditions can the authors guarantee consistency with the paper's results.**
However, we encourage the user to use these files to experiment with their own setup, simulation, or approach.

### [``V_infinite_diffuse_plane.ipynb``](V_infinite_diffuse_plane.ipynb)
This example details the simulation performed in Section V of the paper, where an "infinite" diffuse reflecting plane is simulated. The accuracy of this simulation is assessed by comparison with the results put forth by [Svensson and Savioja, 2020](https://pubs.aip.org/asa/jasa/article-abstract/156/6/3788/3324169/The-Lambert-diffuse-reflection-model-revisited?redirectedFrom=fulltext).

### [``VIA_triangular_facade.ipynb``](VIA_triangular_facade.ipynb)
This example lays out the different steps of the retro-reflective façade simulation described in Section VI.A of the paper.

### [``VIB_street_canyon_plots.ipynb``](VI_street_canyon_plots.ipynb)
This notebook plots the figures in Section VI.B of the paper. These figures describe the simulation of a street canyon. The example is divided into two main sections:

1. The plotting of the energetic decay relative to a scene with complex scattering walls, in a retro-reflective source-receiver setup. Different scattering modeling approaches are compared and a ray-tracing simulation reference is also plotted. This data can be generated by the user in notebook [``VIB1_street_canyon_decay.ipynb``](VIB1_street_canyon_decay.ipynb)
    - **NOTE:** The simulation files for the generation of the ray-tracing data are not provided in these materials. They can be made available upon reasonable request to the authors. 

2. The plotting of the computational performance measures as a function of different simulation parameters. This data can be generated in example [``VIB2_street_canyon_performance.ipynb``](VIB2_street_canyon_performance.ipynb)

### [``VIB1_street_canyon_decay.ipynb``](VIB1_street_canyon_decay.ipynb)
This example lays out the different steps of the simulation of the ETC of a street canyon with a retro-reflective setup, as described in section VI.B.1 of the paper. The results are stored in local files. A basic plot is provided at the end of the example. To recreate the figures seen in the paper, please check [``VIB_street_canyon_plots.ipynb``](VI_street_canyon_plots.ipynb). The BRDF used in the simulation can be generated by the user in [``App_BRDF_generation.ipynb``](App_BRDF_generation.ipynb).

### [``VIB2_street_canyon_performance.ipynb``](VIB2_street_canyon_performance.ipynb)
This example runs all the computational performance profiling routines used for the results presented in Section VI.B.2 of the paper. The output is stored in local files and can be visualized in [``VIB_street_canyon_plots.ipynb``](VI_street_canyon_plots.ipynb).

**NOTE:** These routines are *extremely time consuming*. The authors recommend against running this example unless the user is certain of their objective. 

**NOTE:** The output of these routines *will not match* the results from the paper perfectly. The simulation will likely be run in a different machine. Furthermore, there may not be full control over the management of a given machine's resources, depending on the operating system and general machine properties. In any case, the observations made in Section VI.B.2 are expected to still be applicable.

Simulation datasets: original vs. user-generated
====================
By default, all examples run with the original datasets used for the paper. However, the user can can run the examples based on their own local simulation results: by changing the variable ``self_data=True``, the examples will pick the results of your previously simulated data. This option is highlighted in the beginning of each relevant document.

Note that some errors may occur, if the simulation output dependencies are not respected. If you decide to run the examples on your own results:
- [``App_BRDF_generation.ipynb``](App_BRDF_generation.ipynb) must be run before [``VIA_triangular_facade.ipynb``](VIA_triangular_facade.ipynb) and [``VIB1_street_canyon_decay.ipynb``](VIB_street_canyon_decay.ipynb) 
    - In order to generate the relevant scattering distributions in the form of BRDF.
- [``VIB1_street_canyon_decay.ipynb``](VIB_street_canyon_decay.ipynb) and [``VIB2_street_canyon_performance.ipynb``](VIB_street_canyon_performance.ipynb) must be run before [``VIB_street_canyon_plots.ipynb``](VIB_street_canyon_decay.ipynb)
    - The infinite plane ETC and performance metrics are stored in local files for convenience. The plotting routines then access said files.

Other content
=============

- ``utils/``
-- This folder contains internal methods used in the different examples.
    - [``utils/brdf_handling.py``](utils/brdf_handling.py) -- This file contains internal methods which handle the BSC spatial definition for the BRDF generation. Some formulas from the paper's Appendix are also implemented here.
    - [``utils/run_simu.py``](utils/run_simu.py) -- This file contains specific methods used for complete sparrowpy simulations. The different methods include specific implementations computational performance measurement, and simulation with specific BRDF assignment from file.
    - [``utils/fig_formatting.py``](utils/fig_formatting.py) -- Methods for formatting and export of figures in the same style as the paper.

- ``resources/`` -- Includes datasets required to run the different examples.
    - ``resources/paper/`` -- Includes the original datasets used in the paper.
        - ``resources\paper\triangle_sim_optimal.s_d.sofa`` -- raw BSC simulation data for the triangular pattern cross-section surface (Appendix).
        - ``brdf_ground.sofa`` -- BRDF data for the ground surface in the street canyon simulation (Section VI.B.1).
        - ``brdf_walls_BSC.sofa`` -- BSC-based BRDF data for the retro-reflective façade application example and the walls of the street canyon example (Sections VI.A and VI.B.1, respectively).
        - ``brdf_walls_RISC.sofa`` -- RISC-based BRDF data for the retro-reflective façade application example and the walls of the street canyon example (Sections VI.A and VI.B.1, respectively).
        - ``\resources\paper\ETCs_psize3.far`` -- ETC data for the sparrowpy simulations of the street canyon application example (Section VI.B.1). *This data respects only to results given the specific simulation parameters stipulated in the paper*.
        - ``resources\paper\inf_plane_data.csv`` -- Contains simulation output data for the infinite diffuse plane cases (Section V).
        - ``resources\paper\street_canyon_perf.json`` -- Contains the raw computational performance measurement data respective to the street canyon simulation (Section VI.B.2).
        - ``resources\paper\raven_facade.csv`` -- ray-tracing ([RAVEN](https://www.virtualacoustics.org/RAVEN/)) simulation output data of the retro-reflective façade application example (Section VI.A).
        - ``resources\paper\streetcanyon_retro.csv.csv`` -- ray-tracing ([RAVEN](https://www.virtualacoustics.org/RAVEN/)) simulation output data of the retro-reflective street canyon application example (Section VI.B.1).

- ``figures/`` -- Includes all the figures used in the paper, following the same naming convention.
    - **NOTE:** Figures exported by the examples will overwrite the existing figures, regardless of the origin of the datasets, unless their names are changed in the code. [``utils/fig_formatting.py``](utils/fig_formatting.py) can be changed to change formatting and export directory type.